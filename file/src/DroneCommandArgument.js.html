<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/DroneCommandArgument.js | minidrone-js</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Parrot Minidrone library"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="minidrone-js"><meta property="twitter:description" content="Parrot Minidrone library"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/Mechazawa/minidrone-js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/CommandParser.js~CommandParser.html">CommandParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/DroneCommand.js~DroneCommand.html">DroneCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/DroneCommandArgument.js~DroneCommandArgument.html">DroneCommandArgument</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/DroneConnection.js~DroneConnection.html">DroneConnection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/InvalidCommandError.js~InvalidCommandError.html">InvalidCommandError</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#util">util</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/util/Enum.js~Enum.html">Enum</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTypeName">getTypeName</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/DroneCommandArgument.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Enum from &apos;./util/Enum&apos;;

/**
 * Drone Command Argument class
 *
 * Used for storing command arguments
 *
 * @property {Enum|undefined} enum - Enum store containing possible enum values if `this.type === &apos;enum&apos;`. If set then `this.hasEnumProperty === true`.
 */
export default class DroneCommandArgument {
  /**
   * Command argument constructor
   * @param {object} raw - Raw command argument data from the xml specification
   */
  constructor(raw) {
    this._name = raw.$.name;
    this._description = String(raw._).trim();
    this._type = raw.$.type;
    this._value = this.type === &apos;string&apos; ? &apos;&apos; : 0;

    // Parse enum if needed
    if (this.type === &apos;enum&apos;) {
      const enumData = {};
      let enumValue = 0;

      for (const option of raw.enum) {
        const enumName = option.$.name;

        enumData[enumName] = enumValue++;
      }

      this._enum = new Enum(enumData);

      Object.defineProperty(this, &apos;enum&apos;, {
        enumerable: false,
        get: () =&gt; this._enum,
      });
    }
  }

  /**
   * Parameter name
   * @returns {string}
   */
  get name() {
    return this._name;
  }

  /**
   * Parameter description
   * @returns {string}
   */
  get description() {
    return this._description;
  }

  /**
   * Parameter type
   * @returns {string}
   */
  get type() {
    return this._type;
  }

  /**
   * Get the parameter value
   * @returns {number|string}
   * @see DroneCommandArgument#type
   */
  get value() {
    if (this.type === &apos;string&apos; &amp;&amp; !this._value.endsWith(&apos;\0&apos;)) {
      return this._value + &apos;\0&apos;;
    } else if (this.type === &apos;float&apos;) {
      return Math.fround(this._value);

      /**
       * Javascript uses doubles by default not fixed
       * precision or decimals. This means that we can
       * just return the value without rounding it.
       */
    }

    return this._value;
  }

  /**
   * Set the parameter value
   * @param {number|string} value - Parameter value
   * @throws TypeError
   */
  set value(value) {
    if (Object.is(value, -0)) {
      value = 0;
    }

    this._value = this._parseValue(value);
  }

  /**
   * If it has the enum property set
   * @returns {boolean}
   */
  get hasEnumProperty() {
    return typeof this.enum !== &apos;undefined&apos;;
  }

  /**
   * Parses the value before setting it
   * @param {number|string} value - Target value
   * @returns {number|string}
   * @private
   * @throws TypeError
   */
  _parseValue(value) {
    switch (this.type) {
      case &apos;enum&apos;:
        if (this.enum.hasKey(value)) {
          return this.enum[value];
        } else if (this.enum.hasValue(value)) {
          return value;
          // } else if (value === 256) {
          //   // This is some BS value I sometimes get from the drone
          //   // Pretty much just means &quot;unavailable&quot;
          //   return value;
        }

        throw new TypeError(`Value ${value} could not be interpreted as an enum value for ${this.name}. Available options are ${this.enum.toString()}`);
      case &apos;string&apos;:
        return String(value);
    }

    // Default behavior
    return Number(value);
  }

  /**
   * Gets the byte size of the value.
   * @returns {number}
   */
  getValueSize() {
    switch (this.type) {
      case &apos;string&apos;:
        return this.value.length;
      case &apos;u8&apos;:
      case &apos;i8&apos;:
        return 1;
      case &apos;u16&apos;:
      case &apos;i16&apos;:
        return 2;
      case &apos;u32&apos;:
      case &apos;i32&apos;:
        return 4;
      case &apos;u64&apos;:
      case &apos;i64&apos;:
        return 8;
      case &apos;float&apos;:
        return 4;
      case &apos;double&apos;:
        return 8;
      case &apos;enum&apos;:
        return 4;
    }

    return 0;
  }

  /**
   * Returns a string representation of the DroneCommandArgument instance
   * @param {boolean} debug - If extra debug info should be shown.
   * @param {number} precision - Amount of precision for numerical values
   * @returns {string}
   */
  toString(debug = false, precision = 3) {
    let value;

    switch (this.type) {
      case &apos;string&apos;:
        value = this.value;

        while (value.endsWith(&apos;\0&apos;)) {
          value = value.substring(0, value.length - 1);
        }

        value = `&quot;${value}&quot;`;
        break;
      case &apos;u8&apos;:
      case &apos;i8&apos;:
      case &apos;u16&apos;:
      case &apos;i16&apos;:
      case &apos;u32&apos;:
      case &apos;i32&apos;:
      case &apos;u64&apos;:
      case &apos;i64&apos;:
        value = this.value;
        break;
      case &apos;float&apos;:
      case &apos;double&apos;:
        // This will provide a reasonable estimate of the
        // floating point value for debugging purposes.
        value = this.value.toFixed(precision).replace(/0+$/, &apos;&apos;);
        break;
      case &apos;enum&apos;:
        value = `&quot;${this.enum.findForValue(this.value)}&quot;[${this.value}]`;
        break;
    }

    if (!debug) {
      return `${this.name}=${value}`;
    }

    return `(${this.type})${this.name}=${value}`;
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
